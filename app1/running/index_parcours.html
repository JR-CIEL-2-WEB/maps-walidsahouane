<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>parcours</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&display=swap');

    body {
      font-family: 'Orbitron', sans-serif;
      background: #000;
      color: #fff;
      padding: 30px;
      box-sizing: border-box;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
    }

    h1 { font-size: 2rem; margin-bottom: 12px; color: #fff; }

    .controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 18px;
      align-items: center;
    }

    .btn-parcours, .btn-open-map {
      background: linear-gradient(90deg,#3818b8,#6c34b9);
      color: #fff;
      padding: 10px 18px;
      border: 2px solid #3818b8;
      border-radius: 30px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      cursor: pointer;
      font-weight: 600;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
    }
    .btn-parcours:hover, .btn-open-map:hover {
      background: #fff;
      color: #3818b8;
      transform: scale(1.03);
      box-shadow: 0 0 12px #3818b8;
    }

    .select-parcours {
      background: #111;
      border: 2px solid #3818b8;
      color: #fff;
      padding: 10px;
      border-radius: 8px;
      font-family: 'Orbitron', sans-serif;
    }

    /* zone carte (cachée par défaut) */
    .map-wrapper {
      margin-top: 18px;
      display: none; /* s'affiche après clic */
      border: 3px solid #3818b8;
      border-radius: 6px;
      overflow: hidden;
      height: 60vh;
      min-height: 400px;
      background: #222;
    }

    .map-wrapper iframe {
      width: 100%;
      height: 100%;
      border: 0;
    }

    /* petit texte indicateur */
    .info {
      margin-top: 10px;
      color: #bfbfff;
      font-size: 0.95rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Parcours</h1>

    <div class="controls" aria-hidden="false">
      <!-- select pour choisir le parcours -->
      <select id="parcours-select" class="select-parcours" aria-label="Choisir un parcours">
        <option value="default">Parcours par défaut</option>
      </select>

      <!-- bouton principal (celui que tu voulais) -->
      <button id="btn-show-map" class="btn-parcours">Découvrir les parcours</button>

      <!-- ouvre la map Google Maps complète dans un nouvel onglet -->
      <a id="btn-open-full" class="btn-open-map" target="_blank" rel="noopener">Ouvrir dans Google Maps</a>
    </div>

    <div id="map-wrapper" class="map-wrapper" aria-live="polite">
      <!-- iframe sera injectée ici -->
    </div>

    <p class="info">Astuce : utilise le bouton "Ouvrir dans Google Maps" pour naviguer dans l'application Google Maps complète.</p>
  </div>

  <script>
    // chemin vers le fichier JSON (doit être dans le même dossier)
    const configUrl = 'map-config.json';

    let config = null;

    async function loadConfig() {
      try {
        const res = await fetch(configUrl);
        if (!res.ok) throw new Error('Impossible de charger la config JSON');
        config = await res.json();
      } catch (err) {
        console.error(err);
        // fallback minimal si fetch échoue
        config = {
          default: { lat: 48.9362, lng: 2.4148, zoom: 14, label: 'Parcours par défaut' },
          places: []
        };
      }
    }

    function populateSelect() {
      const sel = document.getElementById('parcours-select');
      // vider sauf default
      sel.innerHTML = '<option value="default">Parcours par défaut</option>';
      if (config && Array.isArray(config.places)) {
        config.places.forEach(p => {
          const opt = document.createElement('option');
          opt.value = p.id || `${p.lat}_${p.lng}`;
          opt.textContent = p.name + ' — ' + (p.label || '');
          opt.dataset.lat = p.lat;
          opt.dataset.lng = p.lng;
          opt.dataset.zoom = p.zoom || config.default.zoom || 14;
          sel.appendChild(opt);
        });
      }
    }

    function buildEmbedUrl(lat, lng, zoom) {
      // URL d'embed sans clé API (ouvre Google Maps embed simple)
      // q=lat,lng permet d'afficher la position, z = zoom, output=embed pour iframe
      return `https://www.google.com/maps?q=${lat},${lng}&z=${zoom}&output=embed`;
    }

    function buildFullMapsUrl(lat, lng, label) {
      // URL pour ouvrir Google Maps dans un nouvel onglet
      const q = encodeURIComponent(label ? `${label} @ ${lat},${lng}` : `${lat},${lng}`);
      return `https://www.google.com/maps/search/?api=1&query=${q}`;
    }

    function showMapForSelection() {
      const sel = document.getElementById('parcours-select');
      const chosen = sel.options[sel.selectedIndex];
      const lat = chosen.dataset.lat || config.default.lat;
      const lng = chosen.dataset.lng || config.default.lng;
      const zoom = chosen.dataset.zoom || config.default.zoom || 14;
      const label = chosen.textContent || config.default.label || '';

      const embedUrl = buildEmbedUrl(lat, lng, zoom);
      const mapWrapper = document.getElementById('map-wrapper');

      // inject iframe
      mapWrapper.innerHTML = `<iframe title="Carte Google Maps - ${label}" src="${embedUrl}" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>`;
      mapWrapper.style.display = 'block';

      // mettre à jour le bouton "Ouvrir dans Google Maps"
      const openBtn = document.getElementById('btn-open-full');
      openBtn.href = buildFullMapsUrl(lat, lng, label);
    }

    // initialisation
    (async function init() {
      await loadConfig();
      populateSelect();

      // clic sur le bouton principal
      document.getElementById('btn-show-map').addEventListener('click', () => {
        showMapForSelection();
      });

      // aussi, changement de sélection mettra à jour le lien "ouvrir" mais n'affiche pas la map tant que l'utilisateur n'a pas cliqué
      document.getElementById('parcours-select').addEventListener('change', () => {
        const sel = document.getElementById('parcours-select');
        const chosen = sel.options[sel.selectedIndex];
        const lat = chosen.dataset.lat || config.default.lat;
        const lng = chosen.dataset.lng || config.default.lng;
        const label = chosen.textContent || config.default.label;
        document.getElementById('btn-open-full').href = buildFullMapsUrl(lat, lng, label);
      });

      // initial update du lien open
      const first = document.getElementById('parcours-select').options[0];
      document.getElementById('btn-open-full').href = buildFullMapsUrl(
        first.dataset.lat || config.default.lat,
        first.dataset.lng || config.default.lng,
        first.textContent || config.default.label
      );
    })();
  </script>
</body>
</html>
